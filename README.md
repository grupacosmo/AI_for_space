<div style="text-align:center"><img src=https://raw.githubusercontent.com/grupacosmo/AI_for_space/main/assets_for_readme/AI_Layers_ENG.png /></div>

# AI for space
Implementation of artificial intelligence image processing on Sipeed Maix development board and dataset generator intended for use in space applications.
### Generate training dataset
[Dataset generator for blender](https://github.com/grupacosmo/Dataset_generator_for_blender/tree/8fa3f61c1433aa02e49f6e498e27bd4cc942f127) allows you to generate images with corresponding annotation files for object detection training. In addition to dataset generator python script cubesat and Earth 3d model used in example is available [here](https://drive.google.com/file/d/1Qk3qYjgNaC1pGa7IhwhDjou38zbyEGih/view?usp=sharing)

<details><summary><b>Show Exmaple image</b></summary>
	
<div style="text-align:center"><img src=https://drive.google.com/uc?id=1eM-nqmNBr69SQu6ntxc427t7TKHYRyhM /></div>
</details>
<details><summary><b>Show corresponding xml annotation file</b></summary>
<pre>

```xml
<annotation verified="yes">
	<folder>imgs</folder>
	<filename>0131.jpg</filename>
	<path>cubesat_detector/imgs</path>
	<source>
		<database>rendered</database>
	</source>
	<size>
		<width>320</width>
		<height>240</height>
		<deph>3</deph>
	</size>
	<segmented>0</segmented>
	<object>
		<name>sat</name>
		<pose>Unspecified</pose>
		<truncated>0</truncated>
		<difficult>0</difficult>
		<bndbox>
			<xmin>125</xmin>
			<ymin>49</ymin>
			<xmax>259</xmax>
			<ymax>177</ymax>
		</bndbox>
	</object>
</annotation>
```
</details>

<pb></pb>
[Dataset calibrator](https://github.com/grupacosmo/Dataset_calibrator/tree/f32ead451e9cc1d804b23527a43ab4cdb415ad92) allows you to change hue, saturation, brightness, focus (and many more) of your dataset to mimic real images captured by camera rather than generated by 3D rendering software.

| Image rendered by dataset generator: [A] | Image A captured by camera | Image A modified by dataset calibrator |
| ------------- |:-------------:| -----:|
|![](https://raw.githubusercontent.com/grupacosmo/AI_for_space/main/assets_for_readme/0012.jpg)|![](https://raw.githubusercontent.com/grupacosmo/AI_for_space/main/assets_for_readme/0012org.jpg)|![](https://raw.githubusercontent.com/grupacosmo/AI_for_space/main/assets_for_readme/0012popr.jpg)|
### Object detection and tracking
Neural newtork has been trained on generated datased using keras-based framework [aXeleRate](https://github.com/AIWintermuteAI/aXeleRate).  Thanks to MobileNet5_0 NN architecture the size of final model is just 0.8MB.

<details><summary><b>Show aXeleRate  config file</b></summary>
<pre>

```json
config = {
        "model":{
            "type":                 "Detector",
            "architecture":         "MobileNet5_0",
            "input_size":           224,
            "anchors":              [0.57273, 0.677385, 1.87446, 2.06253, 3.33843, 5.47434, 7.88282, 3.52778, 9.77052, 9.16828],
           "labels":               ["sat"],
            "coord_scale" : 		1.0,
            "class_scale" : 		1.0,
            "object_scale" : 		5.0,
            "no_object_scale" : 	1.0
        },
        "weights" : {
            #"full":   				"/content/dubesat_detector.h5",
            "full":   				"",
            "backend":   		    "imagenet"
        },
        "train" : {
            "actual_epoch":         150,
            "train_image_folder":   "cubesat_detector/imgs",
            "train_annot_folder":   "cubesat_detector/anns",
            "train_times":          1,
            "valid_image_folder":   "cubesat_detector/imgs_validation",
            "valid_annot_folder":   "cubesat_detector/anns_validation",
            "valid_times":          1,
            "valid_metric":         "mAP",
            "batch_size":           15,
            "learning_rate":        1e-4,
            "saved_folder":   		F"/content/drive/My Drive/pascal20_detection",
            "first_trainable_layer": "",
            "augumentation":				True,
            "is_only_detect" : 		False
        },
        "converter" : {
            "type":   				["k210"]
        }
    }
```
</pre>
</details>

Below are some experimental result:

| Cubesat detection in orbit |
| ------------- | 
|![](https://raw.githubusercontent.com/grupacosmo/AI_for_space/main/assets_for_readme/animated.gif) |

| Setup (camera pointing at monitor)| Cubesat detection from camera|
| ------------- | ------------- |
|<div style="text-align:center"><img src="https://raw.githubusercontent.com/grupacosmo/AI_for_space/main/assets_for_readme/setup_ai.jpg" width="240" height="240"></div> |<div style="text-align:center"><img src="https://raw.githubusercontent.com/grupacosmo/AI_for_space/main/assets_for_readme/raw_a.gif" /> |

### Image classification
For Image classification neural newtork has been trained to detect deforestation through oil palm plantation growth. For this task dataset from [WiDS Datathon 2019](https://www.kaggle.com/c/widsdatathon2019/overview) was used. The size of final model is similar to object detection (about 0.8MB).
Below are results from raw camera data:

![](assets_for_readme/class.gif)

### Noise reduction
Coming soon...
### UART MCU comunication
MaixPy board can communicate with external module (e.g. satelite obc) through UART interface. To increase data transfer security error detection algorithm is impelemented on top of UART interface.

![](https://raw.githubusercontent.com/grupacosmo/AI_for_space/main/assets_for_readme/reqest.gif)

List of supported commands:
- change neural network model (0x73)
- get position of detrected object (0x65)
- get dimension of detected area (0x66)
- get probability of detected object (0x67)
- get class of detected object (0x68)
- get  index of detected object (0x69)
- get number of objects detected (0x6A)
- change module power consumption to low (0x6D)
- change module power consumption to medium (0x6E)
- change module power consumption to high (0x6F)
- reset module (0x6C)


